{% extends 'ultimatereview/base.html' %}

{% load staticfiles %}

{% block title %}{{ review_name }}{% endblock %}


{% block body_block %}

<html>
<head>
	<link rel="stylesheet" href = "{% static 'css/querybuilder.css' %}">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.mins.js"></script>
	<script src="{% static "js/querybuilder.js" %}"></script>
</head>
<h4 class = "margins">Review Name: {{review.title}}</h4>
<div id = "inputs">
	<select  class = "margins" id = "fType" name = "fieldType">
		<option value = "">All</option>
		<option value = "[author]">Author</option>
		<option value = "[book]">Book</option>
	</select>
	<input  class = "margins" name = "queryBox" id = "queryBox"/>
	<select  class = "margins" id = "eType" name = "entryType">
		<option value = "AND">And</option>
		<option value = "OR">Or</option>
		<option value = "NOT">Not</option>
	</select>
	<button text = "Enter" id = "addButton">Construct</button>
	{% if alert_message %}
	{{ alert_message }}
	{% endif %}
<!-- the user is only allowed to the pool for the stage he is currently at -->
	{% if review.pool == 0 %}
	Search for a query and start your review.
	{% elif review.pool == 1 %}
	<!-- link to the abstract pool -->
	<a href="/ultimatereview/singlereview/{{ review.slug }}/AbstractPool/"><button>Abstract Pool</button></a>
	{% elif review.pool == 2 %}
	<!-- link to the document pool -->
	<a href="/ultimatereview/singlereview/{{ review.slug }}/DocumentPool/"><button>Document Pool</button></a>
    {% elif review.pool == 3 %}
	<!-- link to the final pool -->
	<a href="/ultimatereview/singlereview/{{ review.slug }}/FinalPool/"><button>Final Pool</button></a>
	{% else %}
	This review has not been set to a valid pool stage.<br/>
	Contact administrator.
	{% endif %}
	<form method="POST" action = "/ultimatereview/query_results/">
        <div class = "margins">
  		{% csrf_token %}
  		<textarea cols = "200" rows = "4" id = "queryID" type = "text" name = "queryField"></textarea>
  		<button  class = "margins" type = "submit">Query PubMed</button>
        <input name = "noResults" type = "number" min = "1" max = "20" value = "10">
            <select name = "sortType" value = "Sort Type">
            <option value = "relevance">Relevance</option>
            <option value = "recent">Most Recent</option>
            <option value = "title">Title</option>
        </select>
		<!-- the input below submits the review slug, so that query_results know where these results belong -->
		<input name='review_slug' style="display:none", value="{{ review.slug }}"/>
        </div>
	</form>
	<form id = "saveButton" name = "queries" method="POST" action="/ultimatereview/singlereview/{{ review.slug }}/">
	{% csrf_token %}
        <div class = "margins">
	    <textarea style="display:none;" cols = "200" rows = "4" id = "queryIDb" type = "text" name = "queryField"></textarea>
	    <input  class = "margins" type="submit" value="Save Query" />
            </div>
	</form>
</div>

<div>
    <table border="3" style="width:98%">
        <tr  class="header">
            <td colspan="2">Query Title</td>
        </tr>
        {% if queries %}
        {% for query in queries %}
        <tr>
            <td>
            <button id = "queryAddButton" value = "{{ query.name }}">{{ query.name }}</button></td>
            <td>
		    <form method="POST" action="/ultimatereview/singlereview/{{ review.slug }}/">
			    {% csrf_token %}
                <button type="submit" name="delete_query" value="{{ query.name }}">Delete</button>
            </form>
		</td>
        </tr>
        {% endfor %}
            {% else %}
            <tr>
                <td>You have no queries</td>
            </tr>
        {% endif %}
</div>
<!-- I have added a separate final pool page
<div>
    <table border="3" style="width:98%">
        <tr  class="header">
            <td colspan="2">Document Title</td>
        </tr>
        {% if pages %}
        {% for page in finalpages %}
        <tr>
            <td>
            <p>{{ page.title }}<p>
            <td>
		    <td>
            <a href = {{ page.full }}>Full Text</a>
            </td>
		</td>
        </tr>
        {% endfor %}
            {% else %}
            <tr>
                <td>You have no documents</td>
            </tr>
        {% endif %}
</div> -->

</html>

{% endblock %}
